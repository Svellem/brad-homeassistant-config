#
# Turn on evening lighting if someone is home at SUNSET
#
- alias: 'Sunset Transition'
  trigger:
    platform: sun
    event: sunset
    offset: "-00:40:00"
  condition:
    condition: state
    entity_id: group.tracked_users
    state: 'on'
  action:
    service: scene.turn_on
    entity_id: scene.evening_bright_lights

#
# Turn on lights when someone comes home
# Disarm Alarm
#
- alias: 'Welcome Home - Day'
  trigger:
    platform: state
    entity_id: group.tracked_users
    from: 'off'
    to: 'on'
  condition:
    - condition: sun
      after: sunrise
    - condition: sun
      before: sunset
  action:
    - service: script.turn_on
      entity_id: script.home_disarm
    - service: scene.turn_on
      entity_id: scene.day_dim_lights
    - service: homeassistant.turn_on
      entity_id: switch.transmission_turtle_mode
# Same thing but differnet scene for evening 
- alias: 'Welcome Home - Evening'
  trigger:
    platform: state
    entity_id: group.tracked_users
    from: 'off'
    to: 'on'
  condition:
    - condition: sun
      after: sunset
    - condition: sun
      after: sunrise
  action:
    - service: scene.turn_on
      entity_id: scene.night_dim_lights
    - service: homeassistant.turn_on
      entity_id: switch.transmission_turtle_mode

# Multi-tracker automations for brad
# using input_boolean.bradhome for presence
# which is inside group.tracked_users
#
# Trackers used:
# - device_tracker.bradwenner_bradphone - (? MQTT)
#   device_tracker.bradwenner_ios - iOS
#   device_tracker.bradwenner_owntracks - OwnTracks
#
- alias: 'Brad Away'
  condition:
    condition: state
    entity_id: input_boolean.bradhome
    state: 'on'
  trigger:
    - platform: state
      entity_id: device_tracker.bradwenner_bradphone, device_tracker.bradwenner_ios, device_tracker.bradwenner_owntracks
      to: 'not_home'
      # stop turning shit off when I walk the dog
      for:
        minutes: 10
  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.bradhome

- alias: 'Brad Home'
  condition:
    condition: state
    entity_id: input_boolean.bradhome
    state: 'off'
  trigger:
    - platform: state
      entity_id: device_tracker.bradwenner_bradphone, device_tracker.bradwenner_ios, device_tracker.bradwenner_owntracks
      to: 'home'
  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.bradhome
#
# TURN EVERYTHING OFF WHEN NO ONE IS HOME
#
# IF no one is home, turn off the lights and bandwidth throttles
# If no one is home & NPR is playing, turn off NPR
- alias: See Ya Later
  trigger:
    platform: state
    entity_id: group.tracked_users
    to: 'off'
  action:
    - service: scene.turn_on
      entity_id: scene.all_lights_off
