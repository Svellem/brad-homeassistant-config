#
# NOTIFICATIONS!!!
#

#
# A 9am Notification to...
# KILL KILL KILL
#
- alias: 'Notify - Full Moon'
  trigger:
    platform: time
    at: '09:00:00'
  condition:
    platform: state
    entity_id: sensor.moon
    state: "Full moon"
  action:
    - service: notify.ios_bradwenner_bradphone
      data:
        title: "Hail Satan"
        message: "Tonight is the Full Moon"

# Morning Notifications
# Same Trigger as Alarm, but only if I am home
- alias: 'Notify - Morning Notifications for Brad'
  trigger:
    platform: template
    # delay is in seconds (600=10 minutes)
    value_template: '{{ states.sensor.time.state  ==  states.sensor.alarm_time.state  }}'
  condition:
    condition: or
    conditions:
      - condition: and
        conditions:
          - condition: state
            entity_id: input_boolean.alarmweekday
            state: 'on'
          - condition: time
            weekday:
              - mon
              - tue
              - wed
              - thu
              - fri
      - condition: state
        entity_id: input_boolean.alarmweekday
        state: 'off'
  action:
    # ONLY IF I'M HOME
    - condition: state
      entity_id: input_boolean.bradhome
      state: 'on'
    # IF SO, PROCEED
    - service: notify.ios_bradwenner_bradphone
      data:
        title: "{{ states.sensor.friendly_date.state }}"
        message: "{{ states.sensor.dark_sky_summary.state }} and {{ states.sensor.dark_sky_temperature.state }}Â°F out today. Chance of Rain is {{ states.sensor.dark_sky_precip_probability.state }}%."
        data:
          attachment:
            url: !secret camera_window_jpg
            content-type: jpeg
            hide-thumbnail: false

- alias: 'Notify - Front Door Alert'
  trigger:
    platform: state
    entity_id: binary_sensor.front_door
    to: 'on'
  condition:
    - condition: state
      entity_id: group.tracked_users
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    service: notify.ios_bradwenner_bradphone
    data:
      title: "Security Alert"
      data:
        attachment:
          url: !secret camera_frontdoor_jpg
          content-type: jpeg
          hide-thumbnail: false   

# Remind me to Refill Coffee
# At 10:30p, if I'm home, if Alarm is set, if Coffee is 'RefillWater'+
#
- alias: 'Notify - Evening Coffee Reminder'
  trigger:
    platform: time
    at: '22:30:00'
  condition:
    - condition: state
      entity_id: input_boolean.bradhome
      state: 'on'
    - condition: state
      entity_id: automation.alarm_clock
      state: 'on'
    - condition: state
      entity_id: sensor.coffeemaker
      state: 'RefillWater'
  action:
    service: notify.ios_bradwenner_bradphone
    data:
      title: "Reminder"
      message: "Alarm is set but coffee machine needs to be refilled."

#
# HA Pi Disk Use Gets Above 65%
- alias: 'Notify - HA Pi Disk Use'
  trigger:
    platform: numeric_state
    entity_id: sensor.disk_use__2
    above: 65
  action:
    service: notify.ios_bradwenner_bradphone
    data:
      title: "System Warning"
      message: "HomeAssistant Disk Space is Low"
- alias: 'Notify -  HA Pi Disk Use Critical'
  trigger:
    platform: numeric_state
    entity_id: sensor.disk_use__2
    above: 90
  action:
    service: notify.ios_bradwenner_bradphone
    data:
      title: "System Warning"
      message: "HomeAssistant Disk Space is CRITICALLY Low"

#
# NEW HA Release
- alias: 'Notify - New Home Assistant'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.ios_bradwenner_bradphone
    data:
      title: "System Message"
      message: "Home Assistant {{ states.updater.updater.state }} is now available."
